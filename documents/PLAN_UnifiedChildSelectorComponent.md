# План проектирования объединенного компонента "Выбор/Ввод имени ребенка"

## 1. Концепция

"Умный" выпадающий список с возможностью ввода. Компонент будет представлять собой текстовое поле, которое при вводе имени ребенка будет предлагать совпадающие варианты из существующего списка детей. Если совпадений нет, или если пользователь вводит новое имя, будет предложена опция создать нового ребенка.

## 2. Основные характеристики и поведение

*   **Единый элемент управления:** Заменит текущие поля "Выбрать ребенка" и "Имя ребенка" в форме задачи ([`front/src/components/TaskForm.tsx`](front/src/components/TaskForm.tsx:1)).
*   **Ввод и Поиск:**
    *   Пользователь вводит имя ребенка в текстовое поле.
    *   Во время ввода, под полем появляется выпадающий список с детьми, имена которых соответствуют введенному тексту (поиск "на лету").
    *   Отображается только имя ребенка в списке вариантов.
*   **Выбор существующего ребенка:**
    *   Пользователь может выбрать ребенка из выпадающего списка.
    *   После выбора, текстовое поле заполняется именем выбранного ребенка, и его `childId` используется для дальнейших операций.
*   **Создание нового ребенка:**
    *   **Если введенное имя не найдено:** Если пользователь ввел имя, которого нет в списке существующих детей, в выпадающем списке появляется опция "Создать нового ребенка: '[введенное имя]'".
    *   При выборе этой опции, будет инициирован процесс создания нового ребенка (например, открытие модального окна `ChildForm` из [`front/src/components/ChildCardManager.tsx`](front/src/components/ChildCardManager.tsx:15) с предзаполненным именем).
*   **Обработка пустого списка детей:**
    *   Если на момент отображения компонента список детей пуст, вместо поля ввода будет отображаться сообщение (например, "Список детей пуст") и кнопка/ссылка "Добавить ребенка".
    *   Нажатие на эту кнопку/ссылку также инициирует процесс создания нового ребенка.

## 3. Предлагаемый интерфейс компонента (Props)

*   `value: string | null` - ID выбранного ребенка (`childId`) или `null`, если не выбран.
*   `onChange: (childId: string | null, newChildName?: string) => void` - Функция обратного вызова. Передает `childId` выбранного ребенка или `null`. Если создается новый ребенок, `newChildName` будет содержать его имя.
*   `childrenList: Child[]` - Массив объектов детей, доступных для выбора (тип `Child` должен быть импортирован или определен, обычно содержит как минимум `uuid` и `childName`).
*   `onAddNewChildRequest: (childName: string) => void` - Функция, вызываемая, когда пользователь выбирает опцию "Создать нового ребенка". Принимает имя нового ребенка.
*   `onGoToCreateChildPageRequest: () => void` - Функция, вызываемая, когда список детей пуст и пользователь нажимает "Добавить ребенка".
*   `label?: string` - Необязательная метка для поля.
*   `placeholder?: string` - Необязательный плейсхолдер для поля ввода.

## 4. Визуальная схема и логика работы (упрощенно)

```mermaid
graph TD
    Start((Начало)) --> IsChildrenListEmpty{Список детей пуст?};
    IsChildrenListEmpty -- Да --> ShowAddChildButton[Показать кнопку "Добавить ребенка"];
    ShowAddChildButton -- Клик --> TriggerCreateChildPage[Вызвать onGoToCreateChildPageRequest];
    TriggerCreateChildPage --> End((Конец));

    IsChildrenListEmpty -- Нет --> ShowInputField[Показать поле для ввода имени];
    ShowInputField --> UserInput{Пользователь вводит текст};
    UserInput --> FilterList[Фильтровать список детей];
    FilterList --> MatchingResults{Есть совпадения?};

    MatchingResults -- Да --> ShowSuggestions[Показать выпадающий список с совпадениями];
    ShowSuggestions --> UserSelectsChild{Пользователь выбирает ребенка};
    UserSelectsChild -- Да --> UpdateValueWithName[Обновить поле именем, вызвать onChange(childId)];
    UpdateValueWithName --> End;

    MatchingResults -- Нет --> InputNotEmpty{Текст введен?};
    InputNotEmpty -- Да --> ShowCreateOption[Показать опцию "Создать нового: [введенный текст]"];
    ShowCreateOption --> UserSelectsCreate{Пользователь выбирает "Создать"};
    UserSelectsCreate -- Да --> TriggerAddNewChild[Вызвать onAddNewChildRequest(текст)];
    TriggerAddNewChild --> End;
    InputNotEmpty -- Нет --> HideSuggestions[Скрыть выпадающий список];
    HideSuggestions --> End;
```

## 5. Преимущества

*   **Улучшенный UX:** Интуитивно понятный интерфейс, объединяющий выбор и создание.
*   **Эффективность:** Быстрый поиск и возможность добавления ребенка без покидания текущей формы (через модальное окно).
*   **Гибкость:** Позволяет работать как с существующими, так и с новыми детьми.

## 6. Связь с БД (на основе предоставленной схемы)

Компонент будет оперировать `childId` (соответствует `children.id` в БД), который будет использоваться для связи с записью ребенка в таблице `tasks` (через поле `tasks.childId`).